<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="GCBF+">
  <meta name="keywords" content="Multi-agent systems; Distributed control; Safe control; Control barrier functions; Graph neural networks">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GCBF+</title>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/favicon.png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
</head>
<body>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://keunhong.com">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="https://realm.mit.edu">
            REALM Website
          </a>
        </div>
        <!-- <div class="navbar-dropdown">
          <a class="navbar-item" href="https://realm.mit.edu">
            TODO: link to any other pages you want
          </a>
        </div> -->
      </div>
    </div>

  </div>
</nav>


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">GCBF+: A Novel Framework to Train Neural Graph Control Barrier Functions for Safe Multi-agent Control</h1>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://syzhang092218-source.github.io/">Songyuan Zhang</a>,</span>
              <span class="author-block">
                <a href="https://oswinso.xyz/">Oswin So</a>,</span>
            <span class="author-block">
              <a href="https://kunalgarg.mit.edu/">Kunal Garg</a>,</span>
            <span class="author-block">
              <a href="http://chuchu.mit.edu/">Chuchu Fan</a></span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block">Massachusetts Institute of Technology</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="https://arxiv.org/pdf/TODO.pdf"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://arxiv.org/abs/TODO"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
              <!-- Video Link. -->
              <!-- <span class="link-block">
                <a href="https://youtu.be/TODO"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Supplementary Video</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://youtu.be/TODO"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Presentation Video</span>
                </a>
              </span> -->
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/MIT-REALM/gcbfplus/"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="hero teaser">
  <div class="container is-max-desktop">
    <div class="hero-body">
      <div class="hero-body">
        <h2 class="title is-4">Crazyflie switching position using GCBF+</h2>
        <center>
          <img width=40% src="./figs/cf_swap8_overlay.jpg"
          alt="Swapping task for the Crazyflie drone platform using GCBF+"/>
          <video width="52%" autoplay="" muted="" loop="">
            <source src="videos/swap.mp4" type="video/mp4">
          </video>
        </center>
      </div>
      <div class="hero-body">
        <h2 class="title is-4">Crazyflie switching position with moving obstacle using GCBF+</h2>
        <center>
          <img width=40% src="./figs/cf_atk6_overlay.jpg"
          alt="Swapping with a moving obstacle for the Crazyflie drone platform using GCBF+"/>
          <video width="52%" autoplay="" muted="" loop="">
            <source src="videos/attacker.mp4" type="video/mp4">
          </video>
        </center>
      </div>
      <div class="hero-body">
        <h2 class="title is-4">Crazyflie docking using GCBF+</h2>
        <center>
          <img width=40% src="./figs/cf_dock6_overlay.jpg"
          alt="Swapping with a moving obstacle for the Crazyflie drone platform using GCBF+"/>
          <video width="52%" autoplay="" muted="" loop="">
            <source src="videos/docking.mp4" type="video/mp4">
          </video>
        </center>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <!-- Paper video. -->
    <!-- <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Video</h2>
        <div class="publication-video">
          <iframe src="https://www.youtube.com/embed/TODO?rel=0&amp;showinfo=0"
                  frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      </div>
    </div> -->
    <!--/ Paper video. -->

    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Multi-agent systems (MAS) are ubiquitous in today's world with applications ranging from search-and-rescue missions to connected autonomous vehicles, and swarm robotics. However, distributed, scalable, and safe control of large-scale MAS is a challenging problem. In this paper, we design a distributed framework for safe multi-agent control in large-scale environments with moving obstacles, where a large number of agents are required to maintain safety using only local information and reach their goal locations. We introduce a new class of certificates, termed graph control barrier functions (GCBFs), which are based on the well-established CBF theory for safety guarantees and utilize a graph structure for scalable and generalizable distributed control of MAS. We propose a new training framework GCBF+ that uses graph neural networks (GNNs) to parameterize a candidate GCBF certificate and a distributed control policy. The proposed framework is completely distributed and is capable of directly taking point clouds from LiDAR, instead of actual state information, for real-world robotic applications. We illustrate the efficacy of the proposed method through various hardware experiments on a swarm of drones with objectives ranging from exchanging positions to docking on a moving target. Additionally, we perform extensive numerical experiments, where the number and density of agents, as well as the number of unseen and uncontrolled obstacles, increase. Empirical results show that GCBF+ outperforms leading methods such as GCBFv0, InforMARL, a GNN variant of a multi-agent reinforcement learning (RL) algorithm, as well as handcrafted CBF-based methods. Furthermore, the proposed method does not compromise on the performance, in terms of goal reaching, for achieving high safety rates, which is a common trade-off in RL-based methods. 
          </p>
        </div>
      </div>
    </div>
    <!--/ Abstract. -->
  </div>
</section>


<section class="section">
  
  <div class="container is-max-desktop">
    <!-- Main point 1 -->
    <div class="column">
      <h2 class="title is-3">Simulations</h2>
      <div class="content">
        <div class="content has-text-justified">
          <b>
            GCBF+ controller in the DoubleIntegrator environment trained with 8 agents and tested with 64/128 agents
          </b>
          <center>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/DoubleIntegrator_64.mp4" type="video/mp4">
            </video>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/DoubleIntegrator_128.mp4" type="video/mp4">
            </video>
          </center>
          <b> 
            GCBF+ controller with 2D obstacles
          </b>
          <center>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/Obstacle2D_32.mp4" type="video/mp4">
            </video>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/Obstacle2D_64.mp4" type="video/mp4">
            </video>
          </center>
          <b> 
            GCBF+ controller with 3D obstacles
          </b>
          <center>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/Obstacle3D_64.mp4" type="video/mp4">
            </video>
            <video width="40%" autoplay="" muted="" loop="">
              <source src="videos/Obstacle3D_128.mp4" type="video/mp4">
            </video>
          </center>
        </div>
      </div>
    </div>
    <!--/ Main point 1 -->

    <!-- Main point 2 -->
    <h2 class="title is-3">GCBF+ training architecture</h2>
    <div class="column">
      <div class="content">
        
        <img src="figs/train.png"
          class="center-image"
          width="80%"
          alt="algorithm structure"/>
      </div>
    </div>
    <p>
      The graph trajectories \(\{\mathcal G^k_0, \mathcal G^k_1, \mathcal G^k_2, \mathcal G^k_3, \dots, \}\) are generated using the previous step learned control policy \(\pi_\phi\), and is labeled as safe control invariant \(\mathcal S_c\) data and unsafe \(\mathcal S_u\) data for training. A nominal control policy \(\pi_{\mathrm{nom}}\) for goal reaching is used in a CBF-QP with the previously learned GCBF \(h_\theta\) to generate \(\pi_{\mathrm{QP}}\). Then, the QP policy along with the CBF conditions are used to define the loss \(\mathcal L\).
    </p>
    <center>
      <video width="40%" autoplay="" muted="" loop="">
        <source src="videos/cbf.mp4" type="video/mp4">
      </video>
    </center>
    <!-- <img src="figs/cbf.mp4"
      class="center-image"
      width="40%"
      alt="algorithm structure"/> -->
    <p align="center">
      The learned CBF contour.
    </p>
    <!--/ Main point 2 -->

    <div class="column"></div>
    <h2 class="title is-3">An improved loss design compared with <a href="https://mit-realm.github.io/gcbf-website/">GCBFv0</a>.</h2>
    <p>
      GCBF+ uses an improved loss compared with GCBFv0 so that safety does not compete with goal-reaching in the loss. In the following figures, the orange arrows show the learned controls and the black arrows show the reference controls (\(u_\mathrm{nom}\) for GCBFv0 and \(u_\mathrm{QP}\) for GCBF+). 
    </p>
    <div class="column">
      <div class="content">
        <div class="columns is-centered">
          <img src="figs/gcbf_large-1.jpg"
          width="50%"
          alt="algorithm structure"/>
          <p>
            Using large \(\eta_\mathrm{ctrl}\), the training focuses more on behavior cloning the nominal controller, leading to unsafe behavior.
          </p>
        </div>
        <div class="columns is-centered">
          <img src="figs/gcbf_small-1.jpg"
          width="50%"
          alt="algorithm structure"/>
          <p>
            Using small \(\eta_\mathrm{ctrl}\), the training focuses more on safety, and the learned controller cannot reach the goal.
          </p>
        </div>
        <div class="columns is-centered">
          <img src="figs/gcbf_right-1.jpg"
          width="50%"
          alt="algorithm structure"/>
          <p>
            Only when using the fine-tuned \(\eta_\mathrm{ctrl}\) can the learned controller be both safe and goal-reaching. However, the training loss still cannot be zero in this case. 
          </p>
        </div>
        <div class="columns is-centered">
          <img src="figs/gcbf+-1.jpg"
          width="50%"
          alt="algorithm structure"/>
          <p>
            GCBF+ uses \(\pi_\mathrm{QP}\) instead of \(\pi_\mathrm{nom}\), so that the training loss theoretically can go to zero, leading to a controller that is both safe and goal reaching. 
          </p>
        </div>
      </div>
    </div>

    <div class="column"></div>
    <h2 class="title is-3">Using attention to avoid non-smoothness</h2>
    <div class="column">
      <div class="columns is-centered">
        <img src="figs/attn-1.jpg"
          class="center-image"
          width="30%"
          alt="attention"/>
          <p>
            The learned attention value goes to 0 when the neighbor nodes are close to the observation radius (\(R=0.5\)). Therefore when the graph structure changes, i.e., the neighbor nodes enter or leave the observation radius, the learned CBF value does not change too much. 
          </p>
      </div>

    <!-- Main point 3 -->
    <div class="column"></div>
    <h2 class="title is-3">Numerical Results</h2>
    <div class="column">
      <div class="content">
        <img src="figs/env2d.png"
          class="center-image"
          width="100%"
          alt="algorithm structure"/>
      </div>
      <div class="content">
        <img src="figs/env3d.png"
          class="center-image"
          width="100%"
          alt="algorithm structure"/>
      </div>
      <div class="content">
        <img src="figs/obs.png"
          class="center-image"
          width="100%"
          alt="algorithm structure"/>
      </div>
      <p align="center">
        The performance of GCBF+ and the baselines in 2D and 3D environments and environments with obstacles. 
      </p>
    </div>
    <p>
      GCBF+ outperforms the baselines across all the environments because it <b>is guided by a learned GCBF</b>, <b>does not need to balance safety and performance in training</b> and <b>can work with actuator limits</b>.
    </p>
    <!--/ Main point 3 -->


  <!-- Concurrent Work. -->
  <div class="column"></div>
  <h2 class="title is-3">Related Work</h2>
  <div class="column">
    <div class="content">
      <div class="content has-text-justified">
        <p>
          This work improves on our previous work <a href="https://mit-realm.github.io/gcbf-website/">GCBFv0</a>.

          For a survey of the field of learning safe control for multi-robot systems, see <a rel="survey" href="https://arxiv.org/pdf/2311.13714.pdf">this paper</a>.
        </p>
      </div>
    </div>
  </div>
  <!--/ Concurrent Work. -->
</section>


<!-- <section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@article{TODO,
author={TODO, TODO and TODO, TODO},
journal={TODO},
title={TODO},
year={TODO},
volume={TODO},
number={TODO},
pages={TODO},
doi={TODO}}
}</code></pre>
  </div>
</section> -->


<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
            This webpage template is based that used by <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a>. 
            We sincerely thank <a href="https://keunhong.com/">Keunhong Park</a> for developing and open-sourcing this template.
          </p>
        </div>
      </div>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>


</body>
</html>
